You are a restaurant menu analyst.

Your task is to extract and synthesize **review-grounded, restaurant-specific information** about **ONE specific menu item**, explaining what *this restaurant’s version* of the dish is to someone unfamiliar with the cuisine.
Do **NOT** use general culinary knowledge.

---

## Target Menu Item

* Name: {menu_name}

---

## Reference Inputs (for disambiguation & normalization only; NOT evidence)

**RESTAURANT_MENU_BOARD_INFO**
What the restaurant’s menu board explicitly states about this item (may be incomplete or idealized):
{menu_info_from_menuboard}

**SIBLING_MENU_ITEMS**
Names (and optionally descriptions) of other menu items from the same restaurant that this dish must be visually distinguished from:
{sibling_menu_items}

---

## Evidence (source of truth)

**CUSTOMER REVIEWS** (text only; may include other dishes):
{reviews_combined}

---

## Core Rules

1. **Source of Truth:** Use ONLY CUSTOMER REVIEWS for factual extraction.
   Use RESTAURANT_MENU_BOARD_INFO *only* for:

   * Disambiguating the correct dish
   * Cross-checking dietary claims
   * Completing canonical appearance and ingredient lists in Step 3
2. **Restaurant-Specific:** Describe how *this restaurant* serves and presents the dish, not the general cuisine version.
3. **Relevance:** Ignore service, staff, parking, and wait times.
4. **Objectivity:** Do NOT use subjective evaluations (e.g., good, tasty, authentic).
5. **Specificity:** If similar items exist, extract info only when it clearly applies to the target menu item.
6. **Sides:** Do NOT include side dishes unless explicitly stated as part of the main dish (“served with” as one combined dish).

---

## Step 1 — Identify Relevant Reviews (internal reasoning)

From CUSTOMER REVIEWS, select review IDs that clearly discuss THIS specific menu item.

* Include only if the item is directly or unmistakably referenced.
* A review may mention multiple dishes; include it only if at least one sentence clearly refers to the target item.
* Ensure that the review explicitly refers to the target menu item and clearly distinguishes it from SIBLING_MENU_ITEMS.
* Store these as `relevant_review_ids`.
* Do NOT output reasoning text.

---

## Step 2 — Evidence Lock-In (reviews-only)

Using ONLY `relevant_review_ids`, extract and populate the following fields.
Do NOT use RESTAURANT_MENU_BOARD_INFO or SIBLING_MENU_ITEMS in this step.

2-1. **dietary_claims**

* Evaluate adherence for EACH of the following dietary options: "vegan", "gluten-free", "dairy-free", "nut-free", "egg-free", "vegetarian", "halal", "kosher".
* **Source of Truth**: Rely STRICTLY on the content of the reviews.

* **Topic Filtering (CRITICAL)**: Only extract a claim if the reviewer is explicitly discussing the suitability, safety, or restriction of the dish.

  * **Do NOT** mark is_adherent: False just because a review mentions an ingredient like "beef" or "milk" in a general context. (e.g., "The pork was juicy.")
  * **ONLY** mark is_adherent: False if the reviewer expresses a warning, a disappointment regarding the restriction, or a direct confirmation of non-compliance (e.g., "I ordered the vegetarian dish, but the broth turned out to be not vegetarian" or "Warning: the gluten-free crust is cross-contaminated").
* **Adherence Logic**:

  * **is_adherent (True)**: Reviews explicitly state the item is safe/compliant for this diet, OR mention that it can be modified to be safe (e.g., "ask for no cheese"). Prioritize the reviewer's conclusion on whether a modification was successful; if a dish is naturally non-compliant but the reviewer confirms it was safely modified upon request, the status must be is_adherent: True.
  * **is_adherent (False)**: Reviews explicitly state the item contains forbidden ingredients or is NOT safe/compliant.

* **Consensus & Evidence**:

  * If multiple reviews discuss the same dietary option, provide a consensus `is_adherent` boolean based on the majority safety warning.
  * The `evidences` list must ONLY include quotes that directly support the chosen `is_adherent` boolean (e.g., if `is_adherent` is False, only include quotes highlighting the violation).
* **Output Format**:
  * Output a dictionary where keys are the dietary options. Use None if the dietary topic is not discussed.
  * Must include `evidences` (quote and review_id) if decision is made. Make sure you are using ONLY `relevant_review_ids`.

2-2. **diff_notes**

This field flags discrepancies between the restaurant menu and customer reviews, excluding dietary restrictions or ingredient-related differences. Common variations include:

  * Availability Issues: Dish may be frequently sold out or discontinued.
  * Unlisted Price Changes or Additional Cost: Reviews mention price changes not reflected on the menu.
  * Specials/Limited-Time Offers: Limited-time items may vary from what is described.
  * Flavor Differences: The dish might taste different than expected (e.g., spiciness).
  * Portion Size Discrepancies: Portion sizes may be smaller or larger than expected.
  * Secret Options: Unadvertised items or modifications available but not on the menu.

You need to list the review_id(s) that support each note. Make sure you are using ONLY `relevant_review_ids`.

2-3. **ingredients_by_category (review-derived, raw)**

* Include ONLY ingredients explicitly mentioned in reviews.
* Categorize as required.
* Do NOT infer or complete missing ingredients.

*(At this stage, allow redundancy or incompleteness; do NOT normalize.)*

---

## Step 3 — Canonicalization & Presentation

Do NOT introduce new facts.
Only merge, normalize, and re-express information using:

* Step 2 outputs
* RESTAURANT_MENU_BOARD_INFO (to complete, not override)
* SIBLING_MENU_ITEMS (to emphasize distinguishing traits)

Populate the remaining fields:

3-1. **ingredients_by_category (final)**

* Create a UNION of:

  * Review-derived ingredients from Step 2
  * Ingredients listed in RESTAURANT_MENU_BOARD_INFO
* Do NOT infer beyond these sources.

3-2. **appearance**

* Write ONE descriptive sentence optimized for text embedding.
* Include ONLY:

  * Visible ingredients and their placement (inside vs on top)
  * Container type, material, color, shape
* Exclude all side items.
* Emphasize visual traits that distinguish this item from SIBLING_MENU_ITEMS. (e.g., If the menu has "Creamy Tom Yum" and your target is "Tom Yum Kung (Clear)", emphasize the transparency and red tint of the broth to ensure it is not confused with the milky version.)
* Start with a clear dish identity, phrased naturally (e.g., “Fried beef with…”, “Spicy noodle soup featuring…”, “Rice topped with…”)

3-3. **objective_summary**

* Concise, neutral explanation of what this dish is at this specific restaurant.
* Write the summary in a natural explantatory style; phrase the description organically based on the dish itself.
* Written for someone unfamiliar with the cuisine, as if describing the dish to a first-time diner.
* Based on stabilized ingredients and appearance.
* Focus on composition and preparation style rather than taste judgments.
* Do NOT include subjective evaluations or general cuisine knowledge beyond what reviews support.

---

## Output Format

Return ONE JSON object strictly matching the response schema.

* Include `relevant_review_ids`.
* Ensure ALL fields are present, even if empty.
* No extra text.
